{"id":"5628c7f7-a684-4170-9f2c-5e742301e96a","eTag":"Ogxx96AcQoLUTEXZIgR1pg==","title":"IIoT Operational Visibility ","tiles":[{"id":"5d265571-ca35-497b-8f9f-3cda4b93e551","title":"Average Value","query":"telemetry\n| where ExpandedNodeId contains strcat(Line,'.',SensorTag)\n| project SourceTimestamp, yaxis = toint(Value)\n| make-series num=avg(yaxis) default=0 on SourceTimestamp in range(_startTime, _endTime, 1m)","dataSourceId":"6ef8ba49-eaec-41f2-843c-54f94fe8ec04","visualType":"line","pageId":"b34de491-da14-4ea4-a39f-7c19954f072f","layout":{"x":0,"y":8,"width":24,"height":8},"visualOptions":{"hideTileTitle":false,"multipleYAxes":{"base":{"id":"-1","label":"Average per minute","columns":[],"yAxisMaximumValue":null,"yAxisMinimumValue":null,"yAxisScale":"linear","horizontalLines":[]},"additional":[]},"hideLegend":true,"xColumnTitle":"Time","xColumn":{"type":"infer"},"yColumns":{"type":"specified","value":["num"]},"seriesColumns":{"type":"infer"},"xAxisScale":"linear","verticalLine":"","crossFilterDisabled":false,"crossFilter":[{"interaction":"dragX","property":"timeRange","parameterId":"09149602-4f92-4a7a-bda6-48b5b9aba418","disabled":false}]},"usedParamVariables":["Line","SensorTag","_endTime","_startTime"]},{"id":"8cc4cc31-5aa4-42c9-a2d3-5a88074e5711","title":"Anomalies (Last 2-hour window)","query":"let stepAggregate = 1m;\nlet temptags = telemetry\n| distinct ExpandedNodeId\n| where ExpandedNodeId contains (SensorTag)\n| project ExpandedNodeId;\ntelemetry\n| where ExpandedNodeId in (temptags) and ExpandedNodeId contains Line\n| project SourceTimestamp, Tag = replace_string(ExpandedNodeId,\"nsu=KEPServerEX;s=Simulator.Line1\",\"\"), yaxis = todouble(Value)\n| make-series num=avg(yaxis) default=0 on SourceTimestamp from (now() - 2h) to now() step stepAggregate by Tag\n| extend series_decompose_anomalies(num,1.5) // very senstive\n| extend series_decompose_anomalies_num_ad_flag = series_multiply(series_multiply(0.5,num), series_decompose_anomalies_num_ad_flag)\n| project \n    AverageValue = num, \n    AnomalyFlags = series_decompose_anomalies_num_ad_flag, \n    AnomalyDetectionScore = series_decompose_anomalies_num_ad_score,\n    AnomalyDetectionBaseLine = series_decompose_anomalies_num_baseline,\n    SourceTimestamp","dataSourceId":"6ef8ba49-eaec-41f2-843c-54f94fe8ec04","visualType":"timechart","pageId":"b34de491-da14-4ea4-a39f-7c19954f072f","layout":{"x":0,"y":0,"width":24,"height":8},"visualOptions":{"hideTileTitle":false,"multipleYAxes":{"base":{"id":"-1","label":"Average per minute","columns":[],"yAxisMaximumValue":null,"yAxisMinimumValue":null,"yAxisScale":"linear","horizontalLines":[]},"additional":[]},"hideLegend":false,"xColumnTitle":"Time","xColumn":{"type":"infer"},"yColumns":{"type":"infer"},"seriesColumns":{"type":"infer"},"xAxisScale":"linear","verticalLine":"","crossFilterDisabled":false,"crossFilter":[{"interaction":"dragX","property":"timeRange","parameterId":"09149602-4f92-4a7a-bda6-48b5b9aba418","disabled":false}]},"usedParamVariables":["Line","SensorTag"]},{"id":"1622bd6b-a877-4623-95a8-9186cad0c401","title":"Average Humidity Value","query":"telemetry\n| where ExpandedNodeId contains strcat(Line,'.Humidity')\n| project SourceTimestamp, yaxis = toint(Value)\n| make-series num=avg(yaxis) default=0 on SourceTimestamp in range(_startTime, _endTime, 1m)","dataSourceId":"6ef8ba49-eaec-41f2-843c-54f94fe8ec04","visualType":"timechart","pageId":"e8f25edf-fe53-4d2d-81f9-911eb913724e","layout":{"x":0,"y":0,"width":24,"height":5},"visualOptions":{"hideTileTitle":false,"multipleYAxes":{"base":{"id":"-1","label":"Average per minute","columns":[],"yAxisMaximumValue":null,"yAxisMinimumValue":null,"yAxisScale":"linear","horizontalLines":[]},"additional":[]},"hideLegend":true,"xColumnTitle":"Time","xColumn":{"type":"infer"},"yColumns":{"type":"specified","value":["num"]},"seriesColumns":{"type":"infer"},"xAxisScale":"linear","verticalLine":"","crossFilterDisabled":false,"crossFilter":[{"interaction":"dragX","property":"timeRange","parameterId":"09149602-4f92-4a7a-bda6-48b5b9aba418","disabled":false}]},"usedParamVariables":["Line","_endTime","_startTime"]},{"id":"7630d0ba-3dd1-4209-95e0-313b4de35d5e","title":"Average of all Tags","query":"telemetry\n| where ExpandedNodeId contains strcat(Line)\n| project SourceTimestamp, yaxis = toint(Value), Tag = replace_string(ExpandedNodeId,\"nsu=KEPServerEX;s=Simulator.Line1.\",\"\")\n| make-series num=avg(yaxis) default=0 on SourceTimestamp in range(_startTime, _endTime, 1m) by Tag","dataSourceId":"6ef8ba49-eaec-41f2-843c-54f94fe8ec04","visualType":"timechart","pageId":"e8f25edf-fe53-4d2d-81f9-911eb913724e","layout":{"x":0,"y":15,"width":24,"height":8},"visualOptions":{"hideTileTitle":false,"multipleYAxes":{"base":{"id":"-1","label":"Average per minute","columns":[],"yAxisMaximumValue":null,"yAxisMinimumValue":null,"yAxisScale":"linear","horizontalLines":[]},"additional":[]},"hideLegend":false,"xColumnTitle":"Time","xColumn":{"type":"infer"},"yColumns":{"type":"infer"},"seriesColumns":{"type":"infer"},"xAxisScale":"linear","verticalLine":"","crossFilterDisabled":false,"crossFilter":[{"interaction":"dragX","property":"timeRange","parameterId":"09149602-4f92-4a7a-bda6-48b5b9aba418","disabled":false}]},"usedParamVariables":["Line","_endTime","_startTime"]},{"id":"0c28c0f6-b39d-4fa3-b945-094b51d51e9c","title":"Average Temperature Value","query":"telemetry\n| where ExpandedNodeId contains strcat(Line,'.Temperature')\n| project SourceTimestamp, yaxis = toint(Value)\n| make-series num=avg(yaxis) default=0 on SourceTimestamp in range(_startTime, _endTime, 1m)","dataSourceId":"6ef8ba49-eaec-41f2-843c-54f94fe8ec04","visualType":"timechart","pageId":"e8f25edf-fe53-4d2d-81f9-911eb913724e","layout":{"x":0,"y":5,"width":24,"height":5},"visualOptions":{"hideTileTitle":false,"multipleYAxes":{"base":{"id":"-1","label":"Average per minute","columns":[],"yAxisMaximumValue":null,"yAxisMinimumValue":null,"yAxisScale":"linear","horizontalLines":[]},"additional":[]},"hideLegend":true,"xColumnTitle":"Time","xColumn":{"type":"infer"},"yColumns":{"type":"specified","value":["num"]},"seriesColumns":{"type":"infer"},"xAxisScale":"linear","verticalLine":"","crossFilterDisabled":false,"crossFilter":[{"interaction":"dragX","property":"timeRange","parameterId":"09149602-4f92-4a7a-bda6-48b5b9aba418","disabled":false}]},"usedParamVariables":["Line","_endTime","_startTime"]},{"id":"eee4ac50-596d-4c54-9d0b-1248bc9bfe6c","title":"Average Speed Value","query":"telemetry\n| where ExpandedNodeId contains strcat(Line,'.Speed')\n| project SourceTimestamp, yaxis = toint(Value)\n| make-series num=avg(yaxis) default=0 on SourceTimestamp in range(_startTime, _endTime, 1m)","dataSourceId":"6ef8ba49-eaec-41f2-843c-54f94fe8ec04","visualType":"timechart","pageId":"e8f25edf-fe53-4d2d-81f9-911eb913724e","layout":{"x":0,"y":10,"width":24,"height":5},"visualOptions":{"hideTileTitle":false,"multipleYAxes":{"base":{"id":"-1","label":"Average per minute","columns":[],"yAxisMaximumValue":null,"yAxisMinimumValue":null,"yAxisScale":"linear","horizontalLines":[]},"additional":[]},"hideLegend":true,"xColumnTitle":"Time","xColumn":{"type":"infer"},"yColumns":{"type":"specified","value":["num"]},"seriesColumns":{"type":"infer"},"xAxisScale":"linear","verticalLine":"","crossFilterDisabled":false,"crossFilter":[{"interaction":"dragX","property":"timeRange","parameterId":"09149602-4f92-4a7a-bda6-48b5b9aba418","disabled":false}]},"usedParamVariables":["Line","_endTime","_startTime"]},{"id":"b7f31a9d-f548-4235-bc42-a7aa8ff6be8d","title":"Machine Status","query":"telemetry\n| where ExpandedNodeId contains Line and ExpandedNodeId contains \"Status\"\n| where SourceTimestamp > _startTime and SourceTimestamp  < _endTime\n| order by SourceTimestamp asc\n| extend prevValue = prev(Value),  prevTimestamp = next(SourceTimestamp)\n| where prevValue != todouble(Value)\n| project ExpandedNodeId, Value, SourceTimestamp\n| extend nextValue = next(Value),  nextTimestamp = next(SourceTimestamp,1,now())\n| where nextValue != todouble(Value)\n| project Duration = todouble(datetime_diff(\"minute\",nextTimestamp,SourceTimestamp)), Value = tostring(Value)\n| summarize sum(Duration) by Value\n| extend Status=replace(@'1', @'Running', Value)\n| extend Status=replace(@'2', @'Starting', Status)\n| extend Status=replace(@'3', @'Idle', Status)\n| extend Status=replace(@'4', @'Stopped', Status)\n| project Status, TotalDurationInMinutes = sum_Duration","dataSourceId":"6ef8ba49-eaec-41f2-843c-54f94fe8ec04","visualType":"pie","pageId":"2d4cd52b-c433-44b9-881b-815e62f22740","layout":{"x":0,"y":0,"width":12,"height":9},"visualOptions":{"hideTileTitle":false,"hideLegend":false,"xColumn":{"type":"specified","value":"Status"},"yColumns":{"type":"specified","value":["TotalDurationInMinutes"]},"seriesColumns":{"type":"infer"},"crossFilterDisabled":false,"labelDisabled":false,"pie__label":["name","percentage"],"tooltipDisabled":false,"pie__tooltip":["name","percentage","value"],"pie__orderBy":"size","pie__kind":"donut","crossFilter":[]},"usedParamVariables":["Line","_endTime","_startTime"]}],"dataSources":[{"id":"b430e1fb-8f43-42ce-8807-e324f214e951","name":"nsnprod","clusterUri":"https://nsnadxprod.eastus.kusto.windows.net/","database":"nsnfrigeriodb","kind":"manual-kusto","scopeId":"kusto"},{"id":"6ef8ba49-eaec-41f2-843c-54f94fe8ec04","name":"IIoT Mfg Dev","clusterUri":"https://iiotmfgdev.westus2.kusto.windows.net/","database":"mfgdb","kind":"manual-kusto","scopeId":"kusto"}],"$schema":"https://dataexplorer.azure.com/static/d/schema/21/dashboard.json","autoRefresh":{"enabled":true,"defaultInterval":"30s","minInterval":"30s"},"parameters":[{"kind":"duration","id":"09149602-4f92-4a7a-bda6-48b5b9aba418","displayName":"Time range","beginVariableName":"_startTime","endVariableName":"_endTime","defaultValue":{"kind":"dynamic","count":1,"unit":"hours"},"showOnPages":{"kind":"all"}},{"kind":"string","id":"2eb00380-ac7a-4c82-8640-fb50237dc467","displayName":"Line","variableName":"Line","selectionType":"single","defaultValue":{"kind":"value","value":"Line1"},"dataSource":{"kind":"static","values":[{"value":"Line1"},{"value":"Line2"},{"value":"Line3"},{"value":"Line4"}]},"showOnPages":{"kind":"all"}},{"kind":"string","id":"b89f1772-6845-4dd5-a633-e3477daa81a5","displayName":"SensorTag","variableName":"SensorTag","selectionType":"single","defaultValue":{"kind":"value","value":"Humidity"},"dataSource":{"kind":"static","values":[{"value":"Humidity"},{"value":"Temperature"},{"value":"Speed"}]},"showOnPages":{"kind":"selection","pageIds":["b34de491-da14-4ea4-a39f-7c19954f072f"]}}],"pages":[{"id":"e8f25edf-fe53-4d2d-81f9-911eb913724e","name":"Line View"},{"id":"b34de491-da14-4ea4-a39f-7c19954f072f","name":"Tag View"},{"name":"Machine Status View","id":"2d4cd52b-c433-44b9-881b-815e62f22740"}],"schema_version":"21"}